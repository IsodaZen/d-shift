---
name: review-code
description: 指定されたファイル・ディレクトリのコードレビューを実施する。コーディング規約準拠、TypeScript品質、Reactパターン、セキュリティ、テスト有無などを多角的にレビューし、優先度付きのレポートを出力する。
license: MIT
metadata:
  author: d-shift
  version: "1.0"
---

指定されたファイルまたはディレクトリのコードレビューを実施する。

**Input**: ファイルパスまたはディレクトリパスを指定。複数パスをスペース区切りで指定可能。省略時はユーザーに確認する。

**Steps**

1. **レビュー対象の特定**

   引数がある場合はそのパスを使用。ない場合は **AskUserQuestion** でユーザーにレビュー対象を確認する。

   指定されたパスがディレクトリの場合、配下の `.ts`, `.tsx` ファイルを再帰的に収集する。

2. **プロジェクト規約の読み込み**

   以下を読み込み、レビュー基準として使用する：
   - `.claude/rules/coding-conventions.md` — コーディング規約
   - `CLAUDE.md` — プロジェクト全体の方針

3. **コードの読み込みとレビュー実施**

   対象ファイルを順に読み込み、以下の観点でレビューする：

   ### レビュー観点

   **a. コーディング規約準拠**
   - 関数コンポーネントの形式（`const Foo: React.FC = () => {}`）
   - ファイル名の命名規則（PascalCase / camelCase）
   - 型定義の配置（`src/types/` に集約されているか）
   - コメントが日本語で記述されているか

   **b. TypeScript品質**
   - `any` 型の不適切な使用
   - 型安全性の問題（型アサーションの乱用、未チェックのnull/undefined等）
   - 未使用のインポート・変数
   - 適切な型定義の有無

   **c. React パターン**
   - フックのルール遵守（条件分岐内でのフック呼び出し等）
   - 不要な再レンダリングの原因となるパターン
   - useEffect の依存配列の問題
   - コンポーネントの責務分離

   **d. セキュリティ**
   - XSS脆弱性（`dangerouslySetInnerHTML` の不適切な使用等）
   - localStorage への機密データ保存
   - 入力値のサニタイズ

   **e. テスト**
   - 対応するテストファイルの存在確認
   - TDD原則に沿っているか（テストファイルがない場合は指摘）

   **f. コードの可読性・保守性**
   - 関数やコンポーネントの過度な複雑さ
   - 重複コード
   - マジックナンバーやハードコードされた文字列

4. **レビューレポートの生成**

   以下の形式でレポートを出力する：

   ```
   ## コードレビュー: <対象パス>

   ### サマリー
   | 項目 | 件数 |
   |------|------|
   | CRITICAL | N |
   | WARNING  | N |
   | SUGGESTION | N |
   | GOOD     | N |

   ### CRITICAL（修正必須）
   - `file.tsx:123` — <問題の説明>
     → 推奨: <具体的な修正方法>

   ### WARNING（修正推奨）
   - `file.tsx:45` — <問題の説明>
     → 推奨: <具体的な修正方法>

   ### SUGGESTION（改善提案）
   - `file.tsx:78` — <改善の説明>
     → 推奨: <具体的な改善方法>

   ### GOOD（良い実装）
   - `file.tsx:90` — <良い点の説明>

   ### 総評
   <全体的な評価と優先的に対応すべき事項>
   ```

**重要度の基準**

| レベル | 基準 |
|--------|------|
| CRITICAL | バグ、セキュリティ脆弱性、データ損失のリスク |
| WARNING | パフォーマンス問題、規約違反、保守性の問題 |
| SUGGESTION | 可読性向上、ベストプラクティスへの改善 |
| GOOD | 規約に沿った良い実装、工夫されたパターン |

**ガードレール**

- コードを変更しない（読み取りのみ）
- 推測でなく、実際のコードに基づいて指摘する
- プロジェクトの規約に照らしてレビューする（一般論だけに頼らない）
- 大量のファイルがある場合は、最も重要な問題に集中する
