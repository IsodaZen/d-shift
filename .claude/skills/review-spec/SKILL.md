---
name: review-spec
description: OpenSpecのメイン仕様（openspec/specs/）をレビューし、構造の完全性、明確性、テスト可能性、実装との整合性を評価する。全仕様横断レビューにも対応。
license: MIT
metadata:
  author: d-shift
  version: "1.0"
---

OpenSpecのメイン仕様（`openspec/specs/`）をレビューし、品質と整合性を評価する。

**Input**: 仕様名を指定。省略時は全仕様を一覧し、ユーザーに選択を求める。`all` を指定した場合は全仕様を横断レビューする。

**Steps**

1. **レビュー対象の特定**

   引数がある場合：
   - `all` → 全仕様を対象にする
   - 仕様名 → `openspec/specs/<仕様名>/spec.md` を対象にする

   引数がない場合：
   - `openspec/specs/` 配下のディレクトリを一覧
   - **AskUserQuestion** でレビュー対象を選択させる（複数選択可、`すべて` オプションも提示）

2. **仕様の読み込み**

   対象の `spec.md` ファイルを読み込む。全仕様レビューの場合は全ファイルを読み込む。

3. **プロジェクトコンテキストの把握**

   以下を参照して、仕様が実プロジェクトと整合しているか確認するための基盤とする：
   - `CLAUDE.md` — プロジェクト概要・技術スタック
   - 実装コード（`src/`）— 仕様と実装の対応関係

4. **個別仕様レビュー**

   各仕様に対して、以下の観点でレビューする：

   ### レビュー観点

   **a. 構造の完全性**
   - 必須セクションの存在（概要、要件、シナリオ等）
   - 各要件に明確なIDまたは見出しがあるか
   - シナリオが要件を網羅しているか

   **b. 明確性**
   - 曖昧な表現がないか（「適切に」「必要に応じて」等の曖昧語）
   - 要件が測定・検証可能か
   - 前提条件と事後条件が明確か

   **c. テスト可能性**
   - 各要件・シナリオからテストケースを導出できるか
   - 受け入れ基準が具体的か
   - エッジケースが考慮されているか

   **d. 実装との整合性**
   - 仕様に対応する実装コードが存在するか
   - 実装が仕様の意図と一致しているか
   - 仕様に記載されているが未実装の機能はないか
   - 実装されているが仕様に記載のない機能はないか

   **e. 仕様間の一貫性**（全仕様レビュー時）
   - 仕様間で矛盾する記述がないか
   - 共通の概念（スタッフ、シフト等）の定義が統一されているか
   - 仕様間の依存関係が明示されているか

5. **レビューレポートの生成**

   ### 個別仕様レビューの場合

   ```
   ## Specレビュー: <仕様名>

   ### サマリー
   | 項目 | 件数 |
   |------|------|
   | CRITICAL | N |
   | WARNING  | N |
   | SUGGESTION | N |
   | GOOD     | N |

   ### CRITICAL（修正必須）
   - <仕様内の該当箇所> — <問題の説明>
     → 推奨: <具体的な修正方法>

   ### WARNING（修正推奨）
   - <仕様内の該当箇所> — <問題の説明>
     → 推奨: <具体的な修正方法>

   ### SUGGESTION（改善提案）
   - <仕様内の該当箇所> — <改善の説明>
     → 推奨: <具体的な改善方法>

   ### GOOD（良い仕様記述）
   - <仕様内の該当箇所> — <良い点の説明>

   ### 実装との対応状況
   | 要件 | 実装状況 | 備考 |
   |------|----------|------|
   | 要件A | 実装済み | `src/...` |
   | 要件B | 未実装 | — |

   ### 総評
   <全体的な評価と優先的に対応すべき事項>
   ```

   ### 全仕様横断レビューの場合

   上記の個別レビューに加えて、横断分析セクションを追加：

   ```
   ## 横断分析

   ### 仕様間の一貫性
   - <一貫性に関する指摘>

   ### 用語の統一性
   | 用語 | 使用箇所 | 問題 |
   |------|----------|------|
   | ... | ... | ... |

   ### 仕様カバレッジ
   - カバーされている領域: <一覧>
   - 不足している可能性のある領域: <一覧>

   ### 全体評価
   <仕様群全体の成熟度と改善の方向性>
   ```

**重要度の基準**

| レベル | 基準 |
|--------|------|
| CRITICAL | 仕様の矛盾、要件の欠落、実装との重大な乖離 |
| WARNING | 曖昧な記述、テスト不可能な要件、仕様間の不整合 |
| SUGGESTION | 構造の改善、エッジケースの追加、記述の明確化 |
| GOOD | 明確で検証可能な要件、網羅的なシナリオ記述 |

**ガードレール**

- 仕様やコードを変更しない（読み取りのみ）
- 実際の仕様内容とコードに基づいてレビューする
- 過度に形式的なレビューを避け、実質的な品質に集中する
- 全仕様レビュー時は横断的な視点を重視する
- 仕様が存在しない場合はその旨を報告し、仕様作成を提案する
