# shift-schedule-view Specification

## Purpose
シフト表を週単位で表形式（行: スタッフ、列: 日付）で表示し、アサイン状況・希望休・駐車場情報を一覧できる機能。スマートフォン対応も含む。
## Requirements
### Requirement: シフト表を週単位で表示できる
システムは、指定した週のシフト表を表形式（行: スタッフ、列: 日付）で表示できなければならない（SHALL）。表示期間は7日間固定とし、週ナビゲーションで前後に移動できる。

#### Scenario: 当週のシフト表が表示される
- **WHEN** ユーザーがシフト表画面を開く
- **THEN** 当週（7日間）のシフト表が表示される

#### Scenario: 前後の週に移動できる
- **WHEN** ユーザーが「前の週」または「次の週」ボタンを押す
- **THEN** 表示期間が1週間分前後に移動したシフト表が表示される

---

### Requirement: 各セルに時間帯の割り当てを表示できる
システムは、シフト表の各セル（スタッフ×日付）に割り当てられた時間帯（午前/午後/夕方）をバッジ形式で表示できなければならない（SHALL）。

#### Scenario: 割り当て済みの時間帯がバッジで表示される
- **WHEN** あるスタッフの特定の日に時間帯が割り当てられている
- **THEN** そのセルに対応する時間帯バッジ（例：「午前」「夕方」）が表示される

#### Scenario: 割り当てがない場合は空白で表示される
- **WHEN** あるスタッフの特定の日に割り当てがない
- **THEN** そのセルは空白で表示される

---

### Requirement: 希望休を色付きで表示できる
システムは、希望休が登録されているセルを視覚的に区別できるよう色付きで表示できなければならない（SHALL）。

#### Scenario: 希望休のセルがハイライト表示される
- **WHEN** 特定のスタッフの特定の日に希望休が登録されている
- **THEN** そのセルが希望休を示す色（例：黄色）でハイライト表示される

---

### Requirement: 駐車場の割り当て番号を表示できる
システムは、シフトが割り当てられたスタッフのうち駐車場を利用するスタッフに対して、駐車場種別と番号（例：A1、B1）をセル内に表示できなければならない（SHALL）。

#### Scenario: 駐車場を利用するスタッフに番号が表示される
- **WHEN** 駐車場利用フラグがONのスタッフにシフトが割り当てられている
- **THEN** そのセルに駐車場番号（例：「A1」）が表示される

#### Scenario: 駐車場を利用しないスタッフには番号が表示されない
- **WHEN** 駐車場利用フラグがOFFのスタッフにシフトが割り当てられている
- **THEN** そのセルに駐車場番号は表示されない

---

### Requirement: スマートフォンで快適に閲覧できる
システムは、スマートフォン（画面幅360px以上）で横スクロールを使って全日程を閲覧できなければならない（SHALL）。

#### Scenario: 横スクロールでシフト表全体を閲覧できる
- **WHEN** ユーザーがスマートフォンでシフト表画面を開く
- **THEN** テーブルが横スクロール可能な形式で表示され、スタッフ列は固定表示される

### Requirement: シフト表画面に「自動生成」ボタンを表示する
システムは、シフト表画面に自動シフト生成を起動するボタンを表示しなければならない（SHALL）。このボタンを押すと `auto-shift-generation` で定義された自動生成フローが開始される。

#### Scenario: 「自動生成」ボタンが表示される
- **WHEN** ユーザーがシフト表画面を開く
- **THEN** 「自動生成」ボタンがシフト表のヘッダー領域に表示される

---

### Requirement: 各日の列に必要人数の不足インジケーターを表示する
システムは、シフト表の各日付列のヘッダー部分に、その日のいずれかの時間帯でアサイン人数が必要人数を下回っている場合に不足インジケーターを表示しなければならない（SHALL）。アサイン人数が必要人数以上の場合はインジケーターを表示しない。

#### Scenario: 不足がある日の列ヘッダーに不足インジケーターが表示される
- **WHEN** ある日のいずれかの時間帯でアサイン人数が必要人数を下回っている
- **THEN** その日の列ヘッダーに不足を示すインジケーター（例：警告アイコン・不足人数の合計）が表示される

#### Scenario: すべての時間帯で必要人数を達成している日はインジケーターが表示されない
- **WHEN** ある日の全時間帯でアサイン人数が必要人数以上である
- **THEN** その日の列ヘッダーに不足インジケーターは表示されない

---

### Requirement: 土曜・日曜・祝日の列ヘッダーを色分けして表示できる

システムは、シフト表の各日付列ヘッダーを曜日・祝日の区分に応じた色で表示できなければならない（SHALL）。
対象は列ヘッダー（`<th>`）のみとし、セル列背景（`<td>`）は対象外とする。
希望休ハイライトや不足インジケーターなど既存のセル背景ロジックには影響しない。

- 日本の祝日の列ヘッダーは赤系の背景・テキスト色で表示する（土曜・日曜と重なる場合も祝日が優先）
- 日曜日（祝日でない）の列ヘッダーは赤系の背景・テキスト色で表示する
- 土曜日（祝日でない）の列ヘッダーは青系の背景・テキスト色で表示する
- 平日（祝日でない月〜金）の列ヘッダーは現状スタイル（グレー系）を維持する

#### Scenario: 土曜日の列ヘッダーが青系で表示される
- **WHEN** シフト表に土曜日が含まれる
- **THEN** その日付の列ヘッダーが青系の背景色・テキスト色（例：`bg-blue-50 text-blue-700`）で表示される

#### Scenario: 日曜日の列ヘッダーが赤系で表示される
- **WHEN** シフト表に日曜日が含まれる
- **THEN** その日付の列ヘッダーが赤系の背景色・テキスト色（例：`bg-red-50 text-red-700`）で表示される

#### Scenario: 祝日（平日）の列ヘッダーが赤系で表示される
- **WHEN** シフト表に日本の祝日（月〜金）が含まれる
- **THEN** その日付の列ヘッダーが赤系の背景色・テキスト色で表示される

#### Scenario: 祝日かつ土曜日の列ヘッダーが赤系で表示される（祝日が優先）
- **WHEN** シフト表に祝日かつ土曜日が含まれる
- **THEN** その日付の列ヘッダーが赤系の背景色・テキスト色で表示される（土曜ではなく祝日として扱われる）

#### Scenario: 祝日かつ日曜日の列ヘッダーが赤系で表示される
- **WHEN** シフト表に祝日かつ日曜日が含まれる
- **THEN** その日付の列ヘッダーが赤系の背景色・テキスト色で表示される

#### Scenario: 平日の列ヘッダーは通常スタイルで表示される
- **WHEN** シフト表の日付が土日祝に該当しない平日である
- **THEN** その日付の列ヘッダーは通常のグレー系スタイルで表示される

---

### Requirement: 日本の祝日をオフラインで判定できる

システムは、日本の祝日（固定祝日・ハッピーマンデー・振替休日・国民の休日）を外部APIに依存せずに判定できなければならない（SHALL）。

#### Scenario: 固定祝日が正しく判定される
- **WHEN** 元日（1月1日）など固定日の祝日の日付（`YYYY-MM-DD` 形式）を渡す
- **THEN** `isJapaneseHoliday` が `true` を返す

#### Scenario: ハッピーマンデーが正しく判定される
- **WHEN** 体育の日（10月第2月曜日）など移動する祝日の日付を渡す
- **THEN** `isJapaneseHoliday` が `true` を返す

#### Scenario: 振替休日が正しく判定される
- **WHEN** 祝日が日曜日に重なった翌月曜日の日付を渡す
- **THEN** `isJapaneseHoliday` が `true` を返す（振替休日として）

#### Scenario: 国民の休日が正しく判定される
- **WHEN** 祝日に挟まれた平日（例：敬老の日と秋分の日の間に挟まれた9月22日など）の日付を渡す
- **THEN** `isJapaneseHoliday` が `true` を返す（国民の休日として）

#### Scenario: 平日は祝日と判定されない
- **WHEN** 祝日でも振替休日でも国民の休日でもない平日の日付を渡す
- **THEN** `isJapaneseHoliday` が `false` を返す

---

### 実装ノート

- `getDayType(dateStr: string): 'weekday' | 'saturday' | 'sunday' | 'holiday'` を `src/utils/dateUtils.ts` に追加する
  - 入力文字列は `YYYY-MM-DD` 形式（ISO 8601）とする
  - 優先順位（上から順に評価）:
    1. `isJapaneseHoliday` が true → `'holiday'`（土曜・日曜と重なる場合も祝日が最優先）
    2. 日曜 → `'sunday'`
    3. 土曜 → `'saturday'`
    4. それ以外 → `'weekday'`
- `isJapaneseHoliday(dateStr: string): boolean` を `src/utils/dateUtils.ts` に追加する
  - 入力文字列は `YYYY-MM-DD` 形式（ISO 8601）とする
  - 固定祝日リストをハードコードで管理する
  - ハッピーマンデー（成人の日・海の日・敬老の日・体育の日）を月・週計算で算出する
  - 振替休日ロジック（祝日が日曜 → 翌月曜が振替）を実装する
  - 国民の休日（祝日に挟まれた平日は休日）ロジックを実装する

---

### Requirement: ヘルプスタッフのアサインをシフト表に表示する

システムは、シフト表の通常スタッフ行の下にヘルプスタッフセクションを設け、各ヘルプスタッフのアサイン状況を表示できなければならない（SHALL）。ヘルプスタッフが1件も登録されていない場合はセクション自体を表示しない。

ヘルプスタッフセクションの表示仕様:
- 通常スタッフ行の後ろに「ヘルプスタッフ」のセクション区切り行を表示する
- 区切り行の後にヘルプスタッフ1名につき1行を表示する
- 各行の左端（固定列）にはヘルプスタッフの氏名を表示する
- 各セルには、そのヘルプスタッフがその日に割り当てられた時間帯バッジ（午前/午後/夕方）を表示する
- 希望休ハイライトは表示しない（ヘルプスタッフは希望休エンティティを持たない）
- 駐車場番号は通常スタッフと同様に表示する

#### Scenario: ヘルプスタッフが登録されている場合にセクションが表示される

- **GIVEN** ヘルプスタッフが1名以上登録されている
- **WHEN** ユーザーがシフト表画面を開く
- **THEN** 通常スタッフ行の下に「ヘルプスタッフ」セクション区切りが表示される
- **AND** 各ヘルプスタッフの行が表示される

#### Scenario: ヘルプスタッフが0件の場合はセクションが表示されない

- **GIVEN** ヘルプスタッフが1件も登録されていない
- **WHEN** ユーザーがシフト表画面を開く
- **THEN** ヘルプスタッフセクション区切りは表示されない

#### Scenario: ヘルプスタッフのアサインバッジが表示される

- **GIVEN** ヘルプスタッフAがある日の午前にアサインされている
- **WHEN** シフト表を表示する
- **THEN** ヘルプスタッフAの行のその日のセルに「午前」バッジが表示される

---

### Requirement: ヘルプスタッフのセルをクリックして手動アサインできる

システムは、シフト表のヘルプスタッフ行のセルをクリックすることで、そのヘルプスタッフの指定日のアサインを手動で追加・削除できなければならない（SHALL）。

手動アサインの仕様:
- セルをクリックすると、時間帯選択モーダルが表示される
- モーダルにはヘルプスタッフの氏名と日付が表示される
- ヘルプスタッフの `availableSlots` に含まれない時間帯は「不可」表示になる（選択は可能）
- 週上限チェックは行わない（ヘルプスタッフには週上限の概念がない）

#### Scenario: ヘルプスタッフのセルをクリックするとモーダルが開く

- **GIVEN** ヘルプスタッフAがシフト表に表示されている
- **WHEN** ユーザーがヘルプスタッフAのある日のセルをクリックする
- **THEN** 時間帯選択モーダルがヘルプスタッフAの氏名と日付とともに表示される

#### Scenario: モーダルで時間帯をトグルしてアサインを追加できる

- **GIVEN** ヘルプスタッフAの時間帯選択モーダルが表示されている
- **AND** 午前がアサインされていない状態である
- **WHEN** ユーザーが「午前」ボタンをタップする
- **THEN** ヘルプスタッフAのその日の午前にアサインが追加される

#### Scenario: モーダルで時間帯をトグルしてアサインを削除できる

- **GIVEN** ヘルプスタッフAの時間帯選択モーダルが表示されている
- **AND** 午前がアサインされている状態である
- **WHEN** ユーザーが「午前」ボタンをタップする
- **THEN** ヘルプスタッフAのその日の午前のアサインが削除される

