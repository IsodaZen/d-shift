## ADDED Requirements

### Requirement: スタッフの希望休を登録できる
システムは、スタッフ単位・日付単位で希望休を登録できなければならない（SHALL）。登録された希望休はLocalStorageに永続化される。

#### Scenario: 希望休を登録できる
- **WHEN** ユーザーが特定のスタッフと日付を選択して希望休を登録する
- **THEN** その希望休がLocalStorageに保存される

#### Scenario: 同一スタッフ・同一日付の希望休は重複登録できない
- **WHEN** ユーザーがすでに登録済みのスタッフ・日付の希望休を再度登録しようとする
- **THEN** 重複エラーが表示され、登録は行われない（または既存データを上書きしない）

---

### Requirement: カレンダーUIで希望休を編集・保存（同期）できる

システムは、スタッフを1人選択した上でカレンダーUIから複数の日付をトグル選択し、「保存」ボタンで希望休をLocalStorageに同期できなければならない（SHALL）。

UIフロー（シフト期間設定済みの場合）:
1. スタッフをセレクトボックスで選択する
2. スタッフ選択後、シフト期間の開始月からカレンダーが表示される
3. すでに登録済みの日付は初期状態から選択済み（ハイライト）で表示される
4. カレンダー上の日付をタップ/クリックして選択・解除をトグルする
5. 「保存」ボタンを押すと、カレンダーの選択状態が正としてLocalStorageに同期される
   - 新たに選択された日付 → 追加登録
   - 選択を解除された登録済み日付 → 削除
   - 変化のない日付 → そのまま

カレンダー表示のルール:
- シフト期間外の日付はグレーアウトして選択不可とする（タップしても選択されない）
- 選択中の日付（登録済み・未登録問わず）は同一のハイライトスタイルで表示する。登録済みと未保存の新規選択を視覚的に区別しない（保存操作を明示するボタンで代替するシンプルな設計）
- 期間が複数月にまたがる場合は「前月」「翌月」ボタンでページ送りする。初期表示はシフト期間の開始月とする
- 「前月」ボタンはシフト期間の開始月では非活性にする。「翌月」ボタンはシフト期間の終了月では非活性にする
- 「保存」ボタンのラベルは「保存」とし、選択状態によらず常時活性とする
- 保存の結果メッセージは、次に日付をタップしたとき、またはスタッフを切り替えたときに消える

> **注記**: 単一登録（`addDayOff`）の挙動は変更しない。フォールバック（シフト期間未設定時）は従来の単一登録UIを引き続き使用する。
> **既存フック関数の扱い**: `addDayOff`（単数形）はフォールバックUIで引き続き使用するため維持する。`deleteDayOff` はUIから直接呼ばれなくなるが、フック関数自体は削除しない（`syncDayOffs` が内部的に同等の操作を行う）。

#### Scenario: スタッフ選択後、登録済み日付が選択済み状態でカレンダーに表示される

- **GIVEN** シフト期間が設定されている
- **AND** スタッフAが選択されている
- **AND** スタッフAの希望休として date1、date2 が登録済みである
- **WHEN** ユーザーが希望休登録フォームを参照する
- **THEN** シフト期間の開始月からカレンダーが表示される
- **AND** date1、date2 は選択済み（ハイライト）状態で表示される
- **AND** シフト期間外の日付はグレーアウトして選択不可で表示される

#### Scenario: スタッフ未選択の場合はカレンダーが表示されない

- **GIVEN** シフト期間が設定されている
- **AND** スタッフが選択されていない
- **WHEN** ユーザーが希望休登録フォームを参照する
- **THEN** カレンダーは表示されない

#### Scenario: カレンダー上の日付をタップして選択・解除できる

- **GIVEN** スタッフが選択されており、カレンダーが表示されている
- **WHEN** ユーザーがシフト期間内の未選択の日付をタップする
- **THEN** その日付が選択状態（ハイライト）になる
- **WHEN** ユーザーが選択済みの日付を再度タップする
- **THEN** その日付の選択が解除される

#### Scenario: シフト期間外の日付はタップしても選択されない

- **GIVEN** カレンダーが表示されており、シフト期間外の日付がある
- **WHEN** ユーザーがシフト期間外の日付をタップする
- **THEN** その日付は選択されない（選択状態に変化しない）

#### Scenario: 保存すると選択状態がLocalStorageに同期される（追加と削除）

- **GIVEN** スタッフAの登録済み希望休が date1 のみである
- **AND** カレンダー上で date1 の選択が解除されており、date2 が新たに選択されている
- **WHEN** ユーザーが「保存」ボタンを押す
- **THEN** date1 の希望休がLocalStorageから削除される
- **AND** date2 の希望休がLocalStorageに追加される
- **AND** フォーム上部に「X件を追加、Y件を削除しました」というメッセージが表示される

#### Scenario: 保存後もカレンダーの選択状態とスタッフ選択は維持される

- **GIVEN** スタッフAが選択されており、date2 が選択された状態で「保存」ボタンを押した直後である
- **WHEN** 保存が完了する
- **THEN** スタッフAの選択は維持される
- **AND** カレンダー上の date2 の選択状態は維持される（保存後にリセットしない）

#### Scenario: 登録済み日付の選択を解除して保存すると希望休が削除される

- **GIVEN** スタッフAの登録済み希望休として date1、date2、date3 が存在する
- **AND** カレンダー上で date2 の選択が解除されている（date1、date3 は選択済みのまま）
- **WHEN** ユーザーが「保存」ボタンを押す
- **THEN** date2 の希望休がLocalStorageから削除される
- **AND** date1、date3 の希望休はそのまま維持される

#### Scenario: 全日付の選択を解除して保存すると全希望休が削除される

- **GIVEN** スタッフAの登録済み希望休として date1、date2 が存在する
- **AND** カレンダー上で date1、date2 の両方の選択が解除されている
- **WHEN** ユーザーが「保存」ボタンを押す
- **THEN** スタッフAの希望休がすべてLocalStorageから削除される
- **AND** 「0件を追加、2件を削除しました」というメッセージが表示される

#### Scenario: 選択状態に変化がない場合は追加・削除ゼロで保存できる

- **GIVEN** スタッフAの登録済み希望休として date1 が存在する
- **AND** カレンダーを開いた直後（date1 が初期選択済み状態）から何も変更していない
- **WHEN** ユーザーが「保存」ボタンを押す
- **THEN** LocalStorageは変更されない
- **AND** 「0件を追加、0件を削除しました」というメッセージが表示される

#### Scenario: スタッフを切り替えると選択状態が切り替え先の登録状態にリセットされる

- **GIVEN** スタッフAが選択されており、日付の選択状態を変更している
- **WHEN** ユーザーがスタッフBに切り替える
- **THEN** カレンダーの選択状態がクリアされ、スタッフBの登録済み希望休が選択済み状態で表示される

---

### Requirement: シフト期間が明示的に保存されていない場合は単一日付入力にフォールバックする

> **背景**: `useShiftPeriod` フックは LocalStorage に期間が未保存の場合でもデフォルト値（当月16日〜翌月15日）を返す（`shiftPeriod` は常に値を持つ）。ただし `isShiftPeriodSaved` フラグが `false` の場合、ユーザーが意図してシフト期間を設定していない状態であり、自動補完された期間でカレンダーを表示するのは操作上紛らわしい。そのため `isShiftPeriodSaved === false` のときはフォールバックUIを提供する。

システムは、`isShiftPeriodSaved` が `false`（ユーザーが明示的にシフト期間を保存していない）の場合、従来の単一日付入力（`<input type="date">`）による1件登録UIを提供しなければならない（SHALL）。

#### Scenario: シフト期間が未保存（isShiftPeriodSaved = false）の場合は日付入力フィールドが表示される

- **GIVEN** ユーザーがシフト期間を明示的に保存したことがない（`isShiftPeriodSaved === false`）
- **WHEN** ユーザーが希望休登録フォームを開く
- **THEN** カレンダーUIではなく、日付入力フィールド（`<input type="date">`）が表示される
- **AND** スタッフと日付を選択して1件ずつ登録できる（既存仕様の挙動を維持する）

#### Scenario: シフト期間を保存済みの場合（isShiftPeriodSaved = true）はカレンダーUIが表示される

- **GIVEN** ユーザーがシフト期間を明示的に保存済みである（`isShiftPeriodSaved === true`）
- **WHEN** ユーザーが希望休登録フォームを開き、スタッフを選択する
- **THEN** カレンダーUIが表示される（日付入力フィールドは表示されない）

---

### Requirement: 希望休一覧をスタッフ別の件数サマリーで表示する

システムは、登録済み希望休の一覧を、スタッフごとに「シフト期間内の件数」を表示する形式で提供しなければならない（SHALL）。個別の日付エントリ一覧は廃止する。

- 希望休が1件以上登録されているスタッフのみ表示する（0件のスタッフは表示しない）
- 「期間内」とはシフト期間（startDate〜endDate）に含まれる日付を指す
- シフト期間が設定されていない場合は、登録されているすべての希望休を件数の対象とする

#### Scenario: スタッフ別サマリーが表示される

- **GIVEN** シフト期間が設定されている
- **AND** スタッフAの希望休が期間内に2件、スタッフBが1件登録されている
- **WHEN** ユーザーが希望休タブを表示する
- **THEN** スタッフAは「2日」、スタッフBは「1日」のように件数が表示される

#### Scenario: 希望休のないスタッフはサマリーに表示されない

- **GIVEN** スタッフCの希望休が1件も登録されていない
- **WHEN** ユーザーが希望休タブを表示する
- **THEN** スタッフCはサマリーに表示されない

#### Scenario: 希望休が0件の場合はサマリーが空を示すメッセージを表示する

- **GIVEN** 登録済みの希望休が1件もない
- **WHEN** ユーザーが希望休タブを表示する
- **THEN** 「登録された希望休はありません」というメッセージが表示される

---

## 実装仕様（フック）

### `useDayOffs` フックへの `syncDayOffs` 追加

`useDayOffs` フックはカレンダーの選択状態をLocalStorageに同期する `syncDayOffs` 関数を提供しなければならない（SHALL）。

```ts
syncDayOffs(staffId: string, dates: string[]): { added: number; removed: number }
```

- `dates` は同期後にLocalStorageに残すべき日付の完全なリスト（`YYYY-MM-DD` 形式）
- `added`: 新規追加された件数（`dates` にあるがLocalStorageにない日付）
- `removed`: 削除された件数（LocalStorageにあるが `dates` にない日付）
- LocalStorageへの書き込みは1回の `setDayOffs` で一括更新し、部分書き込みは発生しない（同期関数）
- UIレイヤーで `YYYY-MM-DD` フォーマットを保証するため、フック内バリデーションは行わない
- 既存の `addDayOff`（単数形）は変更しない

#### Scenario: syncDayOffs が追加件数と削除件数を返す

- **GIVEN** スタッフAの登録済み希望休が date1、date2 の2件である
- **WHEN** `syncDayOffs(staffIdA, [date2, date3])` を呼ぶ（date1 を外し date3 を追加）
- **THEN** `{ added: 1, removed: 1 }` が返る
- **AND** LocalStorageからスタッフAの date1 が削除される
- **AND** LocalStorageにスタッフAの date3 が追加される
- **AND** date2 はそのまま維持される

#### Scenario: syncDayOffs に空配列を渡すとすべて削除される

- **GIVEN** スタッフAの登録済み希望休が date1、date2 の2件である
- **WHEN** `syncDayOffs(staffIdA, [])` を呼ぶ
- **THEN** `{ added: 0, removed: 2 }` が返る
- **AND** スタッフAの希望休がすべてLocalStorageから削除される

#### Scenario: 変化なしで syncDayOffs を呼ぶと added: 0、removed: 0 が返る

- **GIVEN** スタッフAの登録済み希望休が date1 の1件である
- **WHEN** `syncDayOffs(staffIdA, [date1])` を呼ぶ
- **THEN** `{ added: 0, removed: 0 }` が返る
- **AND** LocalStorageは変更されない

#### Scenario: 他スタッフのデータに影響しない

- **GIVEN** スタッフAの希望休が date1、スタッフBの希望休が date2 として登録されている
- **WHEN** `syncDayOffs(staffIdA, [])` を呼ぶ
- **THEN** スタッフAの date1 のみが削除される
- **AND** スタッフBの date2 はそのまま維持される
