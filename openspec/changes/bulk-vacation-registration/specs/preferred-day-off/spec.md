# preferred-day-off Delta Spec（希望休一括登録）

## 追加・変更する要件

### Requirement: 複数の日付をまとめて希望休として一括登録できる

システムは、スタッフを1人選択した上で複数の日付を同時に選択し、一括で希望休を登録できなければならない（SHALL）。

UIフロー（シフト期間設定済みの場合）:
1. スタッフをセレクトボックスで選択する
2. スタッフ選択後、期間内の全日付がチェックボックス一覧として表示される
3. 1つ以上の日付にチェックを入れ「一括登録」ボタンを押す

> **注記**: 一括登録（`addDayOffs`）における重複スキップの挙動は、既存の単一登録（`addDayOff`）の「重複エラー表示」とは異なる。単一登録の挙動は変更しない。一括登録では、複数件の中に重複が含まれる場合はエラーとせずスキップし、新規分のみ登録する。

#### Scenario: シフト期間設定済みの場合、スタッフ選択後に期間内日付をチェックボックスで選択できる

- **GIVEN** シフト期間が設定されている
- **AND** スタッフが選択されている
- **WHEN** ユーザーが希望休登録フォームを参照する
- **THEN** 期間内の全日付がチェックボックス一覧（`M月D日（曜日）` 形式）として表示される

#### Scenario: スタッフ未選択の場合は日付チェックボックスが表示されない

- **GIVEN** シフト期間が設定されている
- **AND** スタッフが選択されていない
- **WHEN** ユーザーが希望休登録フォームを参照する
- **THEN** 日付チェックボックス一覧は表示されない

#### Scenario: 複数日付を選択して一括登録できる

- **GIVEN** スタッフが選択されており、1つ以上の日付チェックボックスが選択されている
- **WHEN** ユーザーが「一括登録」ボタンを押す
- **THEN** 選択されたスタッフのすべての選択日付が希望休としてLocalStorageに保存される
- **AND** 日付チェックボックスの選択状態がすべて解除される（スタッフの選択は維持される）

#### Scenario: 重複する日付は登録をスキップし、新規分のみ登録する

- **GIVEN** 選択した日付の一部がすでに登録済みである
- **WHEN** ユーザーが一括登録を実行する
- **THEN** 未登録の日付のみが新規登録される
- **AND** 登録済みの日付はスキップされる（エラーにはならない）
- **AND** フォーム上部に「X件を登録しました（Y件は重複のためスキップ）」というメッセージが表示される

#### Scenario: 日付が1つも選択されていない場合は登録できない

- **GIVEN** スタッフが選択されているが、日付チェックボックスが1つも選択されていない
- **WHEN** ユーザーが「一括登録」ボタンを押す
- **THEN** 「日付を1つ以上選択してください」というエラーメッセージが表示され、登録は行われない

---

### Requirement: シフト期間未設定時は単一日付入力にフォールバックする

シフト期間が設定されていない場合、従来の単一日付入力（`<input type="date">`）による1件登録UIを提供しなければならない（SHALL）。

#### Scenario: シフト期間未設定時は日付入力フィールドが表示される

- **GIVEN** シフト期間が設定されていない
- **WHEN** ユーザーが希望休登録フォームを開く
- **THEN** チェックボックス一覧ではなく、日付入力フィールド（`<input type="date">`）が表示される
- **AND** スタッフと日付を選択して1件ずつ登録できる

---

## 変更する実装（フック）

### `useDayOffs` フックへの `addDayOffs` 追加

`useDayOffs` フックは複数件を一括登録する `addDayOffs` 関数を提供しなければならない（SHALL）。

```ts
addDayOffs(staffId: string, dates: string[]): { added: number; skipped: number }
```

- `dates` の各要素は `YYYY-MM-DD` 形式の文字列とする（既存の `addDayOff` と同様）
- `added`: 新規登録された件数（重複なし）
- `skipped`: すでに登録済みのためスキップされた件数
- LocalStorageへの書き込みは1回の `setDayOffs` で一括更新し、部分書き込みは発生しない（同期関数）
- 既存の `addDayOff`（単数形）は変更しない

#### Scenario: addDayOffs が新規件数とスキップ件数を返す

- **GIVEN** あるスタッフに対して3日分の日付を渡す（うち1日は登録済み）
- **WHEN** `addDayOffs(staffId, [date1, date2, date3])` を呼ぶ
- **THEN** `{ added: 2, skipped: 1 }` が返る
- **AND** LocalStorageに2件が新規追加される

#### Scenario: addDayOffs に空配列を渡した場合は何もしない

- **GIVEN** dates に空配列 `[]` を渡す
- **WHEN** `addDayOffs(staffId, [])` を呼ぶ
- **THEN** `{ added: 0, skipped: 0 }` が返る
- **AND** LocalStorageは変更されない
