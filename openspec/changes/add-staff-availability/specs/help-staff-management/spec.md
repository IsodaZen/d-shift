# help-staff-management Specification（ヘルプスタッフ管理）

## Purpose

ヘルプスタッフ（外部応援スタッフ）を独立したエンティティとして管理し、稼働可能な日付をカレンダーUIで個別設定できるようにする。通常スタッフとは別に、ヘルプスタッフの登録・編集・削除・一覧表示を提供する。

---

## ADDED Requirements

### Requirement: ヘルプスタッフを登録できる

システムは、氏名・出勤可能時間帯（午前/午後/夕方の複数選択）・駐車場利用有無を入力してヘルプスタッフを登録できなければならない（SHALL）。登録されたヘルプスタッフはLocalStorageに永続化される。

ヘルプスタッフのデータ構造:

```ts
interface HelpStaff {
  id: string                    // crypto.randomUUID() で生成
  name: string
  availableSlots: TimeSlot[]    // 出勤可能時間帯
  availableDates: string[]      // 稼働可能な日付（YYYY-MM-DD）
  usesParking: boolean          // 駐車場利用フラグ
}
```

通常スタッフ（`Staff`）との違い:
- `availableDates`: 稼働可能な日付を個別指定する（通常スタッフは希望休で「出勤しない日」を指定するのに対し、ヘルプスタッフは「出勤できる日」を指定する）
- `maxWeeklyShifts` を持たない: 稼働可能日付で出勤日を制御するため、週上限の概念は不要
- 同名のヘルプスタッフ登録を許可する（同名の外部スタッフが複数いるケースを想定）

#### Scenario: 必須項目を入力してヘルプスタッフを登録できる

- **WHEN** ユーザーが氏名・出勤可能時間帯・駐車場利用有無を入力して登録ボタンを押す
- **THEN** ヘルプスタッフが一覧に追加され、LocalStorageに保存される

#### Scenario: 氏名が未入力の場合は登録できない

- **WHEN** ユーザーが氏名を空欄のまま登録ボタンを押す
- **THEN** バリデーションエラーが表示され、登録は行われない

#### Scenario: 出勤可能時間帯が未選択の場合は登録できない

- **WHEN** ユーザーが出勤可能時間帯を1つも選択せずに登録ボタンを押す
- **THEN** バリデーションエラーが表示され、登録は行われない

---

### Requirement: ヘルプスタッフ情報を編集できる

システムは、登録済みヘルプスタッフの各項目（氏名・出勤可能時間帯・駐車場利用有無）を編集できなければならない（SHALL）。

#### Scenario: ヘルプスタッフ情報を変更して保存できる

- **WHEN** ユーザーが既存ヘルプスタッフの編集画面を開き、任意の項目を変更して保存する
- **THEN** 変更内容がLocalStorageに反映される

#### Scenario: 編集時に氏名を空にすると保存できない

- **GIVEN** ヘルプスタッフの編集画面が開いている
- **WHEN** ユーザーが氏名を空にして保存しようとする
- **THEN** バリデーションエラーが表示され、変更は保存されない

#### Scenario: 編集時に出勤可能時間帯をすべて解除すると保存できない

- **GIVEN** ヘルプスタッフの編集画面が開いている
- **WHEN** ユーザーが出勤可能時間帯をすべて解除して保存しようとする
- **THEN** バリデーションエラーが表示され、変更は保存されない

---

### Requirement: ヘルプスタッフを削除できる

システムは、登録済みヘルプスタッフを削除できなければならない（SHALL）。

#### Scenario: ヘルプスタッフを削除できる

- **WHEN** ユーザーがヘルプスタッフの削除操作を実行する
- **THEN** ヘルプスタッフが一覧から削除され、LocalStorageからも削除される

---

### Requirement: ヘルプスタッフ一覧を表示できる

システムは、登録されたすべてのヘルプスタッフを一覧表示できなければならない（SHALL）。

#### Scenario: ヘルプスタッフ一覧が表示される

- **WHEN** ユーザーがヘルプスタッフ管理画面を開く
- **THEN** 登録済みのすべてのヘルプスタッフが氏名・出勤可能時間帯・駐車場利用有無とともに一覧表示される

#### Scenario: ヘルプスタッフが0件の場合は空状態を表示する

- **WHEN** ヘルプスタッフが1件も登録されていない状態でヘルプスタッフ管理画面を開く
- **THEN** 「ヘルプスタッフが登録されていません」という空状態メッセージが表示される

---

### Requirement: カレンダーUIで稼働可能日付を設定できる

システムは、ヘルプスタッフを1人選択した上でカレンダーUIから稼働可能日付を複数選択し、「保存」ボタンでLocalStorageに保存できなければならない（SHALL）。

UIフロー（シフト期間設定済みの場合）:
1. ヘルプスタッフをセレクトボックスまたは一覧から選択する
2. 選択後、シフト期間の開始月からカレンダーが表示される
3. すでに登録済みの稼働可能日付は初期状態から選択済み（ハイライト）で表示される
4. カレンダー上の日付をタップ/クリックして選択・解除をトグルする
5. 「保存」ボタンを押すと、カレンダーの選択状態が `HelpStaff.availableDates` に保存される

カレンダー表示のルール:
- シフト期間外の日付はグレーアウトして選択不可とする
- 期間が複数月にまたがる場合は「前月」「翌月」ボタンでページ送りする
- 初期表示はシフト期間の開始月とする
- 「前月」ボタンはシフト期間の開始月では非活性にする。「翌月」ボタンはシフト期間の終了月では非活性にする

#### Scenario: ヘルプスタッフ選択後、登録済み稼働可能日付がカレンダーに表示される

- **GIVEN** シフト期間が設定されている
- **AND** ヘルプスタッフAが選択されている
- **AND** ヘルプスタッフAの稼働可能日付として date1、date2 が登録済みである
- **WHEN** カレンダーを表示する
- **THEN** シフト期間の開始月からカレンダーが表示される
- **AND** date1、date2 は選択済み（ハイライト）状態で表示される
- **AND** シフト期間外の日付はグレーアウトして選択不可で表示される

#### Scenario: カレンダー上の日付をタップして選択・解除できる

- **GIVEN** ヘルプスタッフが選択されており、カレンダーが表示されている
- **WHEN** ユーザーがシフト期間内の未選択の日付をタップする
- **THEN** その日付が選択状態（ハイライト）になる
- **WHEN** ユーザーが選択済みの日付を再度タップする
- **THEN** その日付の選択が解除される

#### Scenario: シフト期間外の日付はタップしても選択されない

- **GIVEN** カレンダーが表示されており、シフト期間外の日付がある
- **WHEN** ユーザーがシフト期間外の日付をタップする
- **THEN** その日付は選択されない

#### Scenario: 保存するとavailableDatesが更新される

- **GIVEN** ヘルプスタッフAの稼働可能日付として date1 が登録済みである
- **AND** カレンダー上で date1 の選択が解除されており、date2 が新たに選択されている
- **WHEN** ユーザーが「保存」ボタンを押す
- **THEN** ヘルプスタッフAの `availableDates` が `[date2]` に更新される
- **AND** LocalStorageに保存される

#### Scenario: シフト期間が未設定の場合はカレンダーが表示されない

- **GIVEN** シフト期間が未設定（`isShiftPeriodSaved === false`）である
- **WHEN** ヘルプスタッフタブを表示する
- **THEN** カレンダーは表示されず、「稼働可能日を設定するにはシフト期間を先に設定してください」というメッセージが表示される

---

### Requirement: ヘルプスタッフタブが設定ページに表示される

システムは、設定ページに「ヘルプスタッフ」タブを追加しなければならない（SHALL）。タブのURL は `/settings/help-staff` とする。

タブ内には以下を表示する:
- ヘルプスタッフ一覧（追加・編集・削除操作付き）
- 稼働可能日付設定カレンダー（ヘルプスタッフ選択時）

#### Scenario: ヘルプスタッフタブにアクセスできる

- **WHEN** ユーザーが `/settings/help-staff` にアクセスする
- **THEN** 設定ページのヘルプスタッフタブが選択された状態で表示される

#### Scenario: タブ一覧にヘルプスタッフが含まれる

- **WHEN** ユーザーが設定ページを表示する
- **THEN** タブ一覧に「ヘルプスタッフ」タブが含まれる

> **注記（screen-navigation仕様への影響）**: 本仕様の実装に伴い、`screen-navigation` 仕様の SettingsPage タブ一覧に `help-staff`（URL: `/settings/help-staff`、ラベル: ヘルプスタッフ）を追加する必要がある。タブの位置は「駐車場」タブの後（末尾）とする。
