# auto-shift-generation Delta Spec（スケジューリング制約追加）

## 追加・変更する要件

### Requirement: 出勤日には利用可能な全時間帯にアサインする（強制制約）

システムは、自動生成時にあるスタッフをある日に出勤させる場合、そのスタッフが出勤可能として登録されている**全ての時間帯**にアサインしなければならない（SHALL）。特定の時間帯のみにアサインし、他の利用可能時間帯をスキップすることは禁止する。

#### Scenario: 複数時間帯対応スタッフは全時間帯にアサインされる
- **GIVEN** スタッフAの出勤可能時間帯が「午前・午後」として登録されている
- **WHEN** 自動生成でスタッフAをある日に出勤させると決定する
- **THEN** スタッフAは午前と午後の両方にアサインされる（午後のみ・午前のみは禁止）

#### Scenario: 単一時間帯対応スタッフはその時間帯のみにアサインされる
- **GIVEN** スタッフBの出勤可能時間帯が「午前」のみとして登録されている
- **WHEN** 自動生成でスタッフBをある日に出勤させると決定する
- **THEN** スタッフBは午前のみにアサインされる

---

### Requirement: 各時間帯の必要人数を超えるアサインを禁止する（強制制約・例外あり）

システムは、自動生成時に各日・各時間帯のアサイン人数が必要人数（requiredCount）を超えないよう制御しなければならない（SHALL）。全時間帯が必要人数を満たしている場合、それ以上スタッフをアサインしてはならない（SHALL NOT）。

**例外**: いずれかの時間帯のスタッフが不足しており、「全時間帯出勤の原則」を適用することにより別の時間帯で必要人数を超える場合は、その超過を許容する（MAY）。その場合でも、超過人数が最小となるようスタッフ数を最小化しなければならない（SHALL）。

#### Scenario: 必要人数を超えてアサインしない（通常ケース）
- **GIVEN** ある日の午前の必要人数が2人、利用可能な候補スタッフが4人いる
- **WHEN** 自動生成を実行する
- **THEN** 午前にアサインされるスタッフは2人以下である（必要人数を超えない）

#### Scenario: 全時間帯が満たされたらそれ以上アサインしない
- **GIVEN** ある日の全時間帯が必要人数を満たしている
- **WHEN** まだアサインされていない候補スタッフが残っている
- **THEN** 追加のスタッフはアサインされない

#### Scenario: 全時間帯出勤の原則による超過は許容するが最小化する
- **GIVEN** 午前の必要人数が3人、午後の必要人数が1人
- **AND** 候補スタッフは全員「午前・午後」両方に対応可能
- **WHEN** 午前の必要人数（3人）を満たすために3人をアサインする
- **THEN** 午後に3人アサインされる（必要1人を超えるが、午前不足回避のために許容）
- **AND** 不要に4人目以降をアサインしない（超過を最小化）
