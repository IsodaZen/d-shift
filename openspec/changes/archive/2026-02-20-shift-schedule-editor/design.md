## Context

シフト管理ツールの新規開発。バックエンドなし・フロントエンドのみの構成。
主な利用者はエンジニアリング知識のない30代女性で、スマートフォンからの利用がメイン。
既存実装はなく、ゼロから構築する。

データの永続化はブラウザのLocalStorageで行い、外部APIへの依存はなし。

## Goals / Non-Goals

**Goals:**
- スタッフ情報・シフト枠・希望休をLocalStorageで管理できる
- シフト表を月単位で表示し、色付き・駐車場番号付きで視認性よく表示できる
- 希望休により必要人数を下回る場合にヘルプスタッフ要否を自動判定できる
- スマートフォン（モバイルファースト）で快適に操作できるUI

**Non-Goals:**
- 自動シフト自動生成（最適化アルゴリズムによる割り当て自動化）は行わない。担当者が手動でアサインする
- ユーザー認証・複数ユーザー間のデータ共有は行わない
- 印刷・PDF出力は今回の対象外
- 過去データの統計分析は対象外

## Decisions

### D1: データ永続化 — LocalStorageのみ（サーバーなし）

**選択**: `localStorage` にJSON形式で保存する。

- **理由**: バックエンドなしの静的サイト要件。外部依存なし。オフライン動作が保証される。
- **検討した代替案**:
  - IndexedDB: 大容量だが実装コストが高く、今回のデータ量（スタッフ数十名、数ヶ月分）では不要
  - sessionStorage: タブを閉じるとデータが消えるため不適

**ストレージキー設計**:
```
d-shift:staff        → Staff[]
d-shift:shift-config → ShiftConfig（シフト枠・必要人数）
d-shift:day-offs     → PreferredDayOff[]
d-shift:assignments  → ShiftAssignment[]
d-shift:parking      → ParkingConfig
```

---

### D2: 状態管理 — React Context + useReducer

**選択**: グローバルな状態をReact Contextで管理し、useReducerで更新する。カスタムフックでLocalStorageとの同期を抽象化する。

- **理由**: Reduxは導入コストが高い。データ規模が小さいためContextで十分。
- **検討した代替案**:
  - Zustand / Jotai: 軽量だが外部ライブラリの追加が必要
  - useState のみ: ページ間でのデータ共有が困難

**フック設計**:
- `useStaff()`: スタッフCRUD
- `useShiftConfig()`: シフト枠・必要人数の取得・更新
- `useDayOffs()`: 希望休の登録・削除
- `useAssignments()`: シフト割り当てのCRUD
- `useHelpAlert()`: ヘルプスタッフ要否の算出（派生データ、ストア不要）

---

### D3: 日付操作ライブラリ — date-fns

**選択**: `date-fns` を追加する。

- **理由**: Dateオブジェクトの直接操作はタイムゾーン・月末処理でバグが出やすい。date-fnsはツリーシェイキング可能で軽量。
- **検討した代替案**:
  - dayjs: 軽量だがプラグイン設計が分かりにくい
  - 標準Dateのみ: コードが冗長になりバグリスクが高い

---

### D4: UIレイアウト — モバイルファースト、タブ切り替え型

**選択**: 画面を「シフト表」「スタッフ管理」「設定」の3タブ構成にする。ボトムナビゲーション（モバイル標準パターン）を採用。

- **理由**: 非エンジニアの利用者が迷わない最小構成。スマートフォンの親指操作に最適。
- **シフト表示**: 横スクロール可能なテーブル（日付 × スタッフ）。セルに時間帯バッジを表示。

---

### D5: シフト割り当ての単位

**選択**: 1件の割り当て = `(staffId, date, timeSlot)` の組として管理。手動アサインのみ。

- **理由**: 自動最適化はスコープ外。担当者がUIから直接チェックして割り当てる操作フローにする。
- **バリデーション**:
  - 週上限出勤回数を超えるアサインは警告表示（保存はできる）
  - 出勤不可時間帯へのアサインは警告表示
  - 希望休日へのアサインは赤ハイライト表示

---

### D6: 駐車場割り当て

**選択**: 駐車場はスタッフ属性（`usesParking: boolean`）とシフト割り当て時に自動で枠を仮割り当て。種別（A/B）は枠数設定から先着順で割り当てる。

- **初期値**: A×4、B×1（設定画面で変更可能）
- **表示**: シフト表のセルに `A1`、`B1` などを小文字で表示

---

## Risks / Trade-offs

- **LocalStorageの容量制限（5MB）**: 数ヶ月・数十名程度であれば問題ないが、長期運用では古いデータのクリア機能が必要になる可能性がある → 初版はアラートなし、将来対応
- **同時編集不可**: 複数端末で同時編集すると上書きが発生する → 単一ユーザー想定のため許容。必要になればエクスポート/インポートで対応
- **横スクロールテーブルのUX**: 列数が多いと視認性が下がる → 表示期間を週単位（7日）に絞り、月ナビゲーションで切り替え
- **ヘルプスタッフ判定は自動計算のみ**: 実際のヘルプ手配はシステム外で行う → アラート表示に留め、管理はユーザー側に委ねる

## Open Questions

- シフト表の表示単位: 週（7日）固定 or 月全体をスクロール？ → 初版は週固定で進める
- 希望休の登録: スタッフ自身が入力 or 管理者が代理入力？ → 初版は管理者が代理入力する想定（認証なし）
- 駐車場の割り当て変更: 自動割り当て後に手動変更できるか？ → 初版は自動割り当てのみ（手動変更は将来対応）
